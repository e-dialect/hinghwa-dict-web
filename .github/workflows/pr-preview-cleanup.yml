name: PR Preview Cleanup from Tencent COS
on:
  pull_request:
    types: [closed]

jobs:
  cleanup-preview:
    runs-on: ubuntu-latest
    steps:
      - name: Install coscmd
        run: |
          pip install coscmd
          coscmd config -a ${{ secrets.TENCENT_CLOUD_SECRET_ID }} -s ${{ secrets.TENCENT_CLOUD_SECRET_KEY }} -b ${{ secrets.TENCENT_CLOUD_BUCKET }} -r ${{ secrets.TENCENT_CLOUD_REGION }}

      - name: Delete PR preview directory from COS
        run: |
          coscmd delete -r /pr-${{ github.event.number }}/
        env:
          TENCENT_CLOUD_SECRET_ID: ${{ secrets.TENCENT_CLOUD_SECRET_ID }}
          TENCENT_CLOUD_SECRET_KEY: ${{ secrets.TENCENT_CLOUD_SECRET_KEY }}
          TENCENT_CLOUD_BUCKET: ${{ secrets.TENCENT_CLOUD_BUCKET }}
          TENCENT_CLOUD_REGION: ${{ secrets.TENCENT_CLOUD_REGION }}
